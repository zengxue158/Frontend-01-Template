# 周总结

# 事件循环 (event loop)

## 事件循环是什么？

事件循环不属于JavaScript引擎实现的东西，而是由浏览器或node js宿主环境实现的.事件循环是浏览器执行任务的机制，它会不断循环判断消息队列中是否有任务，队列中的任务都是指宏任务，而宏任务中包含微任务队列，在宏任务结束前后执行微任务队列，知道微任务队列中为空才结束这个宏任务。

## 消息队列是什么？

消息队列是一种先进先出的数据结构，用于存放要执行的任务。

## 宏任务是什么？

宏任务是消息队列中的一个task，它可能是由用户交互、资源加载、script、web api（setTimeout, setInterval, setImmediate等）等所产生的。

## 微任务是什么？

微任务是宏任务中的一个子任务组，在宏任务结束前执行，为什么会有微任务的出现？因为在消息队列中无法根据优先级来执行任务，导致实时性较高的任务无法立即执行，像监听DOM元素的MutationObserve等，Promise.resolve 和 Promise.reject 都会产生一个微任务。微任务中也有可能产生一个微任务，当所以微任务执行完成才会结束当前的宏任务。

# 浏览器的进程和线程（拓展）

### 单进程浏览器
在2007年之前，市面上的浏览器是一个单进程浏览器，所以功能模块都运行在一个进程中，模块包括：网络、插件、JavaScript运行环境、渲染引擎和页面等。

单进程浏览器的缺陷：

1. 不稳定：早期浏览器需要借助插件来实现web视频、web游戏，插件一旦崩溃，浏览器也同时会崩溃。
2. 不流畅：因为单进程浏览器的页面渲染和JavaScript环境和插件都运行在页面线程中，一旦某个环节阻塞就导致浏览器失去响应和卡顿。
3. 不安全：插件可以用C/C++来编写，通过插件有权访问操作系统中的资源，意味着你的文件和密码就有被泄漏的可能性。

### 多进程浏览器时代

1. 解决不稳定的问题：由于进程是相互隔离的，其中一个进程崩溃不会影响到其他进程。
2. 解决不流畅的问题：JavaScript只在渲染进程中，不会影响到浏览器和其他页面。
3. 解决不安全的问题：多进程采用了安全沙箱，可以理解成在操作系统给进程加上了锁，沙盒里面的程序可以运行，但不能访问你的硬盘中的读写。chrome把插件进程和渲染进程锁在沙盒里面，恶意程序无法在沙箱中获取系统权限。

### 目前多进程架构
* 浏览器进程: 主要负责界面显示、用户交互、子进程管理、同时提供储存等功能。
* 渲染进程：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎Blink和JavaScript引擎V8都是运行在该进程中。chrom会在一个页面中打开了一个同域的页面时会保持一个进程，如果是两个同域名的tab也会有多个渲染进程。处出于安全问题，渲染进程都是运行在沙盒中。
* GPU进程：从浏览器进程中独立出来。
* 网络进程：从浏览器进程中独立出来。
* 插件进程。

